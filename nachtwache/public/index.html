<!DOCTYPE html>
<html>
  <head>
    <title>Nachtwache Index</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="js/jquery-3.2.1.js" type="text/javascript"></script>
    <script type="text/javascript">
      var chessBoard = {
        imgSrcs: ['bB', 'bK', 'bN', 'bP', 'bQ', 'bR',
                  'wB', 'wK', 'wN', 'wP', 'wQ', 'wR'],

        imgObjs: [],
        
        init: function () {
          this.canvas = document.querySelector('#canvas');
          this.context = canvas.getContext('2d');
          this.context.scale(40, 40);
          var k = 0;
          for (var i = 0; i < 8; i++) {
            for (var j = 0; j < 8; j++) {
              let pic = this.imgObjs[k];
              this.rawDraw(j, i, 1, 1, pic);
              k++;
              if(k > this.imgObjs.length - 1) {
                k = 0;
              }
            }
          }
          this.canvas.addEventListener('mousedown', function (e) {
            var xPos = e.clientX - parseInt(chessBoard.canvas.style.left);
            var yPos = e.clientY - parseInt(chessBoard.canvas.style.top);
            console.log('V => ' + xPos + '#' + yPos);
            console.log(chessBoard.getSquareForCoordinates(xPos, yPos));
          });
          this.canvas.addEventListener('mouseup', function (e) {
            e.stopPropagation();
            var xPos = e.clientX - parseInt(chessBoard.canvas.style.left);
            var yPos = e.clientY - parseInt(chessBoard.canvas.style.top);
            console.log('A => ' + xPos + '#' + yPos);
            console.log(chessBoard.getSquareForCoordinates(xPos, yPos));
          });
          document.addEventListener('mouseup', function (e) {
            console.log('A OUT => ' + (e.clientX - parseInt(chessBoard.canvas.style.left)) + '#' +
                  (e.clientY - parseInt(chessBoard.canvas.style.top)));
          });
        },

        draw: function(col, row, w, h, img) {
          context.fillRect(indexForColLetter(col), indexForRowNumber(row), 1, 1);
          if(img) {
            this.context.drawImage(img, col, row, w, h);
          }
        },

        rawDraw: function (x, y, w, h, img) {
          this.context.fillStyle = (x + y) % 2 ? 'yellow' : 'blue';
          this.context.fillRect(x, y, w, h);
          if(img) {
            this.context.drawImage(img, x, y, w, h);
          }
        },

        indexForColLetter: function (colLetter) {
          return 'abcdefgh'.indexOf(colLetter.toLowerCase());
        },

        indexForRowNumber: function (rowNumber) {
          return 8 - rowNumber - 1;
        },

        colLetterForIndex: function (idx) {
          return 'abcdefgh'.split('')[idx];
        },

        rowNumberForIndex: function (idx) {
          return 8 - idx;
        },

        drawTest: function () {
          context.drawImage(img, 40, 40, 40, 40);
        },
        getRawSquareForCoordinates: function (left, top) {
          return [Math.floor(left / 40), Math.floor(top / 40)];
        },
        getSquareForCoordinates: function (left, top) {
          var xyArray = chessBoard.getRawSquareForCoordinates(left, top);
          console.log(xyArray);
          return [chessBoard.colLetterForIndex(xyArray[0]),
                  chessBoard.rowNumberForIndex(xyArray[1])];
        }
      };
      
      chessBoard.imgSrcs.forEach(function(val, idx) {
        let pic = new Image();
        pic.src = './img/' + val + '.png';
        chessBoard.imgObjs.push(pic);
      });
    </script>
  </head>
  <body onload="chessBoard.init()">
    <canvas id="canvas" width="360" height="360" style="position:absolute; left:20px; top:20px;"></canvas>
    <a href="javascript:chessBoard.drawTest()">drawtest</a>
  </body>
</html>
